<!doctype html>
<html><head><meta charset="utf-8"><title>Bluetooth</title>
<link rel="stylesheet" href="/static/style.css"></head>
<body>
<h1>Bluetooth</h1>
<p><button id="scan">Scan</button></p>
<div id="scanout">(no scan yet)</div>
<h3>Previously seen</h3>
<ul>
  {% for d in paired %}
    <li>{{ d.name }} ({{ d.mac }})</li>
  {% endfor %}
</ul>
<p><a href="/">Back</a></p>
<script>
const out = document.getElementById('scanout');
document.getElementById('scan').onclick = async () => {
  out.textContent = 'Scanningâ€¦';
  const r = await fetch('/bt/scan_json');
  const j = await r.json();
  if(!j.ok){ out.textContent = 'Scan failed: '+(j.error||''); return; }
  out.innerHTML = '';
  j.devices.forEach(d => {
    const li = document.createElement('div');
    const btn = document.createElement('button');
    btn.textContent = 'Connect';
    btn.onclick = async () => {
      const fd = new FormData();
      fd.append('mac', d.mac);
      fd.append('save_as_preferred', 'on');
      const r2 = await fetch('/bt/connect_json', { method:'POST', body:fd });
      const j2 = await r2.json();
      alert(j2.ok ? 'Connected' : ('Failed: ' + (j2.error||'')));
    };
    li.textContent = d.name+' ('+d.mac+') ';
    li.appendChild(btn);
    out.appendChild(li);
  });
};
</script>
</body></html>
